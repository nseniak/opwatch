# Channels

- [Channels](#channels)
  * [Channel configuration](#channel-configuration)
  * [Channel definitions](#channel-definitions)
    + [Console](#console)
    + [Pushover](#pushover)
    + [Slack](#slack)
    + [Remote](#remote)
    
## Channel configuration

Opwatch displays alerts and other messages on *channels*. To configure the channels used by Opwatch,
use the following call:

```js
config.channels(configuration)
```

where the configuration object has the form:

```js
{
  "services": {
	"<channel type 1>": <channel definitions>, 	
	"<channel type 2>": <channel definitions>
	// etc
  }
  "applicationChannel": "<channel name>", 
  "systemChannel": "<channel name>", 
  "fallbackChannel": "<channel name>" 
}
```

`"<channel type 1>"`, `"<channel type 2>"`, etc are names of channel types supported by Opwatch: `console`, `slack`,
`pushover` and `remote`.

For example, the configuration below defines two Slack channels: `developers` and `marketing`, and one
Pushover channel: `devops`. By default, alerts triggered by the `alert` processor go to the `developers` channels.
Messages and errors generated by Opwatch go to the `devops` channel. 

```js
config.channels({
  "services": {
    "slack": {
      "channels": {
        "developers": {
          "webhookUrl": "https://hooks.slack.com/services/somefakeurl1"
        },
        "marketing": {
          "webhookUrl": "https://hooks.slack.com/services/somefakeurl2"
        }
      }
    },
    "pushover": {
      "channels": {
        "devops": {
          "apiToken": "somefakeapitoken",
          "userKey": "somefakeuserkey"
        }
      }
    }
  },
  "applicationChannel": "developers",
  "systemChannel": "devops",
  "fallbackChannel": "console"
});
```

## Channel definitions

This section describes channel definitions for each channel type. 

Opwatch supports the following types of channels:

* The *Console* channel, which prints alerts on the standard output;
* *[Slack](https://slack.com/)* channels, which displays alerts as messages in Slack;
* *[Pushover](https://pushover.net/)* channels, which displays alerts as Pushover notifications;
* *Remote* channels, which send alerts to other Opwatch servers in order to let them display them.

### Console

The `"console"` channel is predefined, and doesn't need to be explicitly defined in the 
`config.channels(configuration)` call.

### Pushover

[Pushover](https://pushover.net/) is a tool for sending notifications to desktop or mobiles devices. A Pushover 
channel definition is parameterized by the following information that you can copy from your Pushover account's 
administration interface:

- A *Pushover API token*, corresponding to a Pushover application;
- A *Pushover user key*, which identifies the user or group of users who receive the push notifications.

To define one or more Pushover channels, use the following syntax:

```js
  "pushover": {
    "channels": {
      "<channel name 1>": <Pushover channel definition 1>
      "<channel name 2>": <Pushover channe definition 2>
    // add Pushover channels here
    }
  }
```

A Pushover channel definition is an object with the following properties:

| Property | Description | Type | Default |
| :--- | :--- | :--- | :--- |
| `apiToken` | Pushover API token | String | *Mandatory* | 
| `userKey` | Pushover user key  | String | *Mandatory* |
| `retry` | how many seconds between retries for emergency messages | Number | 60 |
| `expire` | how many seconds an emergency notification will continue to be retried for | Number | 3600 |
| `maxPerMinute` | maximum number of notifications per minute, after which alerts are throttled | Number | 10 |

Alerts with level `lowest` are pushed as Pushover notifications with priority `lowest`, alerts with level `low` as 
notifications with priority `low`, etc. For an explanation of Pushover levels, retry and expire policies, see
[Pishover API documentation for Message priority](https://pushover.net/api#priority).

### Slack

[Slack](https://slack.com/) is a real-time messaging platform for teams. A Slack channel definition is parameterized 
by a Slack *Incoming WebHook* URL. To obtain a Slack Incoming WebHook URL, go to your Slack account's
[Customer Integrations](https://omcinc.slack.com/apps/manage/custom-integrations) page and click *Incoming WebHooks*, 
then *Add Configuration*. You can then select the Slack channel to which the alerts will be posted. Slack will then
display the Incoming WebHook URL that you can copy and use in the Opwatch channel definition.
  
To define one or more Slack channels, use the following syntax:

```js
  "slack": {
    "channels": {
      "<channel name 1>": <Slack channel definition 1>,
      "<channel name 2>": <Slack channel definition 2>
      // add Slack channels here
    }
  }
```

A Slack channel definition is an object with the following properties:

| Property | Description | Type | Default |
| :--- | :--- | :--- | :--- |
| `webhookUrl` | Slack incoming webhook URL | String | *Mandatory* | 
| `maxPerMinute` | maximum number of notifications per minute, after which alerts are throttled | Number | 10 |

### Remote

Remote channels send alerts to other Opwatch servers, in order to let them publish them. To define one or
more remote channels, use the following syntax: 

```js
  "remote": {
    "channels": {
      "<channel name 1>": <remote channel definition 1>,
      "<channel name 2>": <remote channel definition 2>
      // add remote channels here
    }
  }
```

A remote channel definition is an object with the following properties:

| Property | Description | Type | Default |
| :--- | :--- | :--- | :--- |
| `hostname` | remote Opwatch instance hostname | String | *Mandatory* | 
| `port` | remote Opwatch instance http port number | Number | 28018 |
| `channel` | name of the channel on the remote Opwatch instance | String | *Mandatory* |
